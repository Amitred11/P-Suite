{% extends "base.html" %}
{% block title %}Frontend Optimizer | P-Suite{% endblock %}
{% block content %}
<header class="site-header">
    <div class="header-icon-wrapper" style="background-color: #eef2ff; color: #4f46e5;"><i class="fas fa-palette header-icon"></i></div>
    <h1>Frontend Optimizer</h1>
    <p>Optimize, harden, and prepare your static assets for deployment.</p>
</header>
<main>
    <form id="frontend-optimizer-form" class="tool-form">
        <div id="drop-zone" class="drop-zone">
            <div class="drop-zone-prompt"><i class="fas fa-cloud-upload-alt"></i><p><strong>Drag & Drop Project ZIP</strong></p><span class="prompt-separator">or</span><label for="file-input" class="file-browse-btn">Browse Your Computer</label></div>
            <input type="file" id="file-input" name="file" required accept=".zip">
        </div>
        <div class="advanced-options">
            <h4><i class="fas fa-tools"></i> Optimization Controls</h4>
            <div class="option-grid">
                <div class="option-item"><label class="custom-checkbox" for="add_csp"><input type="checkbox" id="add_csp" name="add_csp" value="true" checked><span class="checkmark"></span>Add Content-Security-Policy</label><small>Hardens HTML against XSS attacks.</small></div>
                <div class="option-item"><label class="custom-checkbox" for="purge_css"><input type="checkbox" id="purge_css" name="purge_css" value="true" checked><span class="checkmark"></span>Purge Unused CSS</label><small>Removes unused styles from CSS files.</small></div>
                <div class="option-item option-item-full-width">
                    <label class="option-label-header">JavaScript Obfuscation</label>
                    <div class="segmented-control">
                        <input type="radio" id="obfuscate_none" name="obfuscate_js" value="none" checked><label for="obfuscate_none" class="segmented-control-label"><i class="fas fa-eye"></i> None</label>
                        <input type="radio" id="obfuscate_basic" name="obfuscate_js" value="basic"><label for="obfuscate_basic" class="segmented-control-label"><i class="fas fa-low-vision"></i> Basic</label>
                        <input type="radio" id="obfuscate_strong" name="obfuscate_js" value="strong"><label for="obfuscate_strong" class="segmented-control-label"><i class="fas fa-mask"></i> Strong</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="advanced-options">
            <h4><i class="fas fa-star"></i> Pro-Exclusive Features</h4>
            <div class="option-grid">
                <div class="option-item {% if current_user.plan != 'pro' %}disabled-feature{% endif %}">
                    <label class="custom-checkbox" for="generate_critical_css">
                        <input type="checkbox" id="generate_critical_css" name="generate_critical_css" value="true" {% if current_user.plan != 'pro' %}disabled{% endif %}>
                        <span class="checkmark"></span> Generate Critical CSS <span class="pro-badge">PRO</span>
                    </label>
                    <small>Massively improves perceived load speed. {% if current_user.plan != 'pro' %}<a href="{{ url_for('main.pricing') }}">Upgrade to Pro to unlock.</a>{% endif %}</small>
                </div>
            </div>
        </div>
        <button type="submit" id="submit-button" class="btn btn-primary" style="width:100%;" disabled><i class="fas fa-play-circle"></i><span>Run Pipeline (1 Credit)</span></button>
    </form>
    
    <div id="processing-section" class="processing-section" style="display:none;">
        <div id="live-console" class="live-console"><div class="console-header"><span id="console-header-title">LIVE CONSOLE</span></div><div class="console-output" id="console-output"></div></div>
    </div>

    <div id="results-section" class="results-section" style="display:none;">
        <div class="results-header"><h2><i class="fas fa-check-circle"></i> Pipeline Complete</h2></div>
        <div class="results-grid">
            <div class="results-card" id="report-summary-container">
                <!-- Summary report will be injected here by JS -->
            </div>
            <div class="results-card">
                <h4><i class="fas fa-folder-open"></i> Optimized Files</h4>
                <div id="file-tree-container">
                    <!-- File tree will be injected here by JS -->
                </div>
                <a href="#" id="download-all-btn" class="btn btn-secondary" style="width: 100%; margin-top: 1rem;"><i class="fas fa-file-archive"></i> Download All as ZIP</a>
            </div>
        </div>
    </div>
    <div id="post-run-actions" style="display:none;">
        <button id="restart-button" class="btn btn-secondary"><i class="fas fa-redo"></i> Run New Optimization</button>
    </div>
</main>
{% endblock %}